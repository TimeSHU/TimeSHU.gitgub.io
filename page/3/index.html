<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Time'Blog</title><meta name="author" content="Time"><meta name="copyright" content="Time"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="Time&#39;Blog">
<meta property="og:url" content="https://timeshu.github.io/page/3/index.html">
<meta property="og:site_name" content="Time&#39;Blog">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://timeshu.github.io/img/avatar.jpg">
<meta property="article:author" content="Time">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://timeshu.github.io/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://timeshu.github.io/page/3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?https://hm.baidu.com/hm.js?5dd9b277051da31b80703896f0394cce";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Time\'Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-01-01 09:52:28'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">22</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://wallroom.io/img/3840x2160/bg-3579ca5.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Time'Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Time'Blog</h1><div id="site-subtitle"><span id="subtitle"></span></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/08/18/Image%E5%9B%BE%E7%89%87%E5%BA%93%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/" title="Image图片库漏洞总结">     <img class="post_bg" src="https://wx2.sinaimg.cn/mw2000/006JDWKCly1gxkhxhgnl5j31ln24wb2e.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Image图片库漏洞总结"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/08/18/Image%E5%9B%BE%E7%89%87%E5%BA%93%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/" title="Image图片库漏洞总结">Image图片库漏洞总结</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-08-17T21:28:42.000Z" title="发表于 2020-08-18 05:28:42">2020-08-18</time></span></div><div class="content">


0x00最近phpstudy爆出Nginx解析漏洞，由于nginx默认配置存在错误配置，导致任意文件都可以解析为php代码。
漏洞原理可参考此链接：https://www.cnblogs.com/yang34/p/13653893.html
当然本文肯定不会是专门讲nginx解析漏洞，而是讲漏洞复现时发现的一个小问题点。本次漏洞复现使用了mkcms和74cms作为漏洞环境进行复现。
下载phpstudy8.1.0.7版本。

​    cms安装成功后，找到可上传图片点
mkcms
​    上传图片马



解析成功。
74cms：



图片的确解析了，但是phpinfo没被解析。



百思不得其解，度娘了一波，大致了解，图片上传时调用图片处理函数对图片进行了剪裁啥的然后重新生成了一张新的图片。而这种方法叫二次渲染。

作为菜逼的我代码也看不懂，只能跟着百度方法C32ASM一波了。
mkcms，原图片和上传后图片的对比，阔以发现没得啥变化，怪不得可以执行成功。

74cms，原图片和上传后图片对比，图片前面已经全部被修改了。。。

尝试了n+++++久。。。。。。好像整个图 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/08/10/xycms%E5%AE%A1%E8%AE%A1/" title="xycms审计">     <img class="post_bg" src="https://wx2.sinaimg.cn/mw2000/006JDWKCly1gxkhxhgnl5j31ln24wb2e.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="xycms审计"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/08/10/xycms%E5%AE%A1%E8%AE%A1/" title="xycms审计">xycms审计</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-08-10T08:53:32.000Z" title="发表于 2020-08-10 16:53:32">2020-08-10</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></span></div><div class="content">


0x00 环境源码：XYCMS-PHP-V1.0
PHP：5.6.40
MYSQL：5.7.26
0x01 前言XYCMS使用原生PHP语句，未使用框架，项目架构如下

目录说明
system	后台目录inc		存放过滤和配置文件install	安装目录其他为前台功能页面

0x02 后台添加信息处通用注入漏洞
&lt;form name="add" method="post" action="?act=ok" onsubmit="return chkform();"&gt;    &lt;table width="100%" border="0" align="center" cellpadding="3" cellspacing="0" &gt;    &lt;tr  onmouseout="style.backgroundColor='#F1F5F8'" bgcolor="#F1F5F8" &gt;    &lt;td height="28" width="10%" class="td"&gt;网页标题&lt;/td&gt;    &lt;td width="90%"   ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/07/30/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/" title="业务安全测试方法总结">     <img class="post_bg" src="https://wx2.sinaimg.cn/mw1024/007YyUgtgy1gxx4m230fsj31900u0k0g.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="业务安全测试方法总结"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/07/30/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/" title="业务安全测试方法总结">业务安全测试方法总结</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-07-30T01:57:53.000Z" title="发表于 2020-07-30 09:57:53">2020-07-30</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/web/">web</a></span></div><div class="content">


0x01 登录认证用户枚举在验证用户身份的时候，或判断用户是否已注册时，若验证码处理不当、或错误提醒明确，都可能存在用户枚举。
案例：


任意密码重置短信验证码回传通过手机找回密码，发送验证码的响应包中包含了短信验证码。
案例：
​    
​    当点击发送按钮后，拦截返回包，短信验证码包含在返回包中，导致可重置账户密码。

用户凭证修改任意账户密码通过手机找回密码是一般需要短信验证码验证（这里可以尝试爆破或绕过），当我们输入正确的手机号和正确的短信验证码，然后进入重置密码的最后一步，也就是输入新的密码，输入密码后提交到服务端的post数据包需要包含当前用户的身份信息，而一般网站是通过用户名或用户ID来标识用户身份的，如果这个用户名或用户ID没有和当前手机号、短信验证码进行绑定，也就是说服务端只验证用户名、ID是否存在，而不去验证用户和当前手机号是否匹配，那么我们就可以通过修改用户名、ID去修改其他用户的密码了。当然可以修改的地方不限于找回密码的数据包，比如修改资料的地方也可能存在这样的漏洞。
案例：
​    以某网站修改任意用户资料导致修改任意账号密码为例，截取的数据包 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/06/27/jwt%E5%AD%A6%E4%B9%A0/" title="jwt学习">     <img class="post_bg" src="https://wx2.sinaimg.cn/mw2000/006JDWKCly1gxkhxhgnl5j31ln24wb2e.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="jwt学习"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/06/27/jwt%E5%AD%A6%E4%B9%A0/" title="jwt学习">jwt学习</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-06-27T14:22:15.000Z" title="发表于 2020-06-27 22:22:15">2020-06-27</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/web/">web</a></span></div><div class="content">


0x00 背景起因：刷题的过程中看见一道题写着kunkun应援团，有应援口号，并集资11540必须买lv6?

滋滋滋，干就完事。
注册了账号，去购物车翻找lv6的商品，由于页数过多，用了个小脚本找到了lv6的商品在181页
脚本
from urllib import requesturl="http://220.249.52.133:47108/shop?page="for i in range(1,501):    r = request.urlopen(url+str(i))    if "lv6.png" in r.read().decode('utf-8'):        print(i)        break    else:        print("lv6 is not in page "+str(i))


抓包修改一波价格

修改失败，提示操作失败，但发现有一次返回为302，并附带一个目录，访问后发现只允许admin访问

并且包中发现网站是通过JWT进行身份验证。无奈想请教一波大佬，结果大佬忙，只得自己研究一波JWT。。。
0x00 JWT基础百度介 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/06/23/NoSql%E6%95%B0%E6%8D%AE%E5%BA%93getShell%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95/" title="无题">     <img class="post_bg" src="https://wx3.sinaimg.cn/mw2000/006JDWKCly1gxkhxkhlq4j31ln24w1l3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/06/23/NoSql%E6%95%B0%E6%8D%AE%E5%BA%93getShell%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95/" title="无题">无题</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-06-23T07:36:16.290Z" title="发表于 2020-06-23 15:36:16">2020-06-23</time></span></div><div class="content">


0x00 背景​    网络已经成为了现代社会中的第五世界，而说起网络就不得不提起数据库,数据库作为存储信息的应用软件，已经深入到了各行各业，购物、外卖、银行、游戏、出行等，可以说只要是提供服务给用户使用的软件或者网站都离不开数据库的应用。而用的最多的是关系型数据库，例如：MYSQL、MSSQL、Oracle。而本文讲解的是非关系型数据库(NoSQL)，NoSQL数据库知道的最多的可能就是MongoDB、Redis、Memcached、Cassandra，但是你们知道NoSQL数据库还有那些吗？NoSQL的注入你们了解的多吗？NoSQL数据库中有哪些数据库是可getshell的？本文就带你了解一下什么是NoSQL数据库，NoSQL数据库的注入方法及getshell的方法。
0x01 NoSQL数据库特性​    NoSQL全称是Not Only SQL，意为不仅仅的SQL。是一种非关系型数据存储模式，它存储的不再是结构化数据，而是类型和固定的格式，以key-value键值对、列式、文档来存储。而相较于关系型数据库，非关系数据库的优点有如下几点：
1、快速读写	主要例子有Redis ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/06/22/xyhcms%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/" title="xyhcms审计学习">     <img class="post_bg" src="https://wx2.sinaimg.cn/mw1024/007YyUgtgy1gxx4m230fsj31900u0k0g.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="xyhcms审计学习"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/06/22/xyhcms%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/" title="xyhcms审计学习">xyhcms审计学习</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-06-22T14:21:26.000Z" title="发表于 2020-06-22 22:21:26">2020-06-22</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></span></div><div class="content">


0x00 CMS核心目录网站使用框架：ThinkphpApp		应用目录data	网站上传配置、编辑器目录include	网站配置调式目录install	安装目录public	公共目录uploads	上传目录

环境：
CMS：XYHCMS V3.5
PHP：5.6
MYSQL：5.7.26
0x01 后台任意文件上传漏洞利用登录后台，有一个可修改网站配置的选项

当在允许附件类型或是允许图片类型处添加php后，可直接上传webshell获取权限。



漏洞分析网站设置——&gt;App/controller/SystemController.class.php/194行 site函数
public function site() {		if (IS_POST) {			$data = I('config', array(), 'trim');//获取网站配置信息            //遍历网站配置项是否存在&lt;?php字符串，如果存在字符串使用空字符串替换掉			foreach ($data as $key =&gt; $val) {				if (stripos($ ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/06/14/xray%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" title="xray基本方法">     <img class="post_bg" src="https://wx4.sinaimg.cn/mw690/63e9b3e7gy1gxxwbq13hhj20ty17i49y.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="xray基本方法"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/06/14/xray%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" title="xray基本方法">xray基本方法</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-06-14T12:18:57.000Z" title="发表于 2020-06-14 20:18:57">2020-06-14</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/web%E5%B7%A5%E5%85%B7/">web工具</a></span></div><div class="content">


0x00 常规扫描爬虫扫描webscan --basic-crawler http://testphp.vulnweb.com/


代理模式扫描浏览器安装代理插件
genca 生成证书  //工具目录会生成两个文件


扫描命令
webscan --listen 127.0.0.1:8888 --html-output 1.html


最后配置浏览器监听端口

会根据在浏览器点击来进行扫描

联动Burp在burp配置一下选项即可


burp 被动流量转发插件
https://github.com/c0ny1/passive-scan-client/releases

听说可以使用awcs+bp+python脚本(自己写)组合成一个自动化漏洞挖掘工具，暂时不懂方法，留个坑
</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/06/13/Thinkphp%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/" title="Thinkphp注入学习(暂未更新)">     <img class="post_bg" src="https://wx2.sinaimg.cn/mw2000/006JDWKCly1gxkhxhgnl5j31ln24wb2e.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Thinkphp注入学习(暂未更新)"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/06/13/Thinkphp%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/" title="Thinkphp注入学习(暂未更新)">Thinkphp注入学习(暂未更新)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-06-12T16:53:43.000Z" title="发表于 2020-06-13 00:53:43">2020-06-13</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></span></div><div class="content">


</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/06/05/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%8F%8D%E7%BC%96%E8%AF%91%E8%8E%B7%E5%8F%96%E6%BA%90%E7%A0%81/" title="微信小程序反编译获取源码">     <img class="post_bg" src="https://wx2.sinaimg.cn/mw2000/006JDWKCly1gxkhxhgnl5j31ln24wb2e.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="微信小程序反编译获取源码"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/06/05/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%8F%8D%E7%BC%96%E8%AF%91%E8%8E%B7%E5%8F%96%E6%BA%90%E7%A0%81/" title="微信小程序反编译获取源码">微信小程序反编译获取源码</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-06-05T09:33:19.000Z" title="发表于 2020-06-05 17:33:19">2020-06-05</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">小程序</a></span></div><div class="content">


0x00 环境搭建1、Nodejs
​        下载连接: https://nodejs.org/zh-cn/download/ 
​        安装成功后，在系统中配置环境变量即可，运行node -v，如下图说明安装成功
​    
2、反编译脚本，github搜索wxappUnpacker或其他版本(由于敏感此处不放连接，自行下载)
3、模拟器(手机)，夜神、雷神、逍遥等都可以。
0x01 前期准备1、下载RE文件管理器，允许使用超级管理员权限
2、手机已ROOT或使用模拟器ROOT模式
3、下载微信
0x02 获取小程序包当点开一个微信小程序，如果本地这个文件夹下找到即将运行的小程序，会从微信服务器下载到本地，在以后的某个时刻又运行这个小程序，运行时，微信服务器会通知有没有小程序新版本，如有新版本，会在后台静默下载，小程序继续运行，新版本要到下一次运行才会启用，这就是微信小程序的更新机制。
小程序包地址：/data/data/com.tencent.mm/MicroMsg/随机长字符串/appbrand/pkg/
将pkg文件夹中的包清空，返回微信打开需要抓取的小 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/06/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5%E8%AF%AD%E5%8F%A5%E6%94%B6%E9%9B%86%E5%8F%8A%E5%AD%A6%E4%B9%A0/" title="数据库注入语句收集及学习">     <img class="post_bg" src="https://images.pexels.com/photos/10620135/pexels-photo-10620135.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据库注入语句收集及学习"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/06/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5%E8%AF%AD%E5%8F%A5%E6%94%B6%E9%9B%86%E5%8F%8A%E5%AD%A6%E4%B9%A0/" title="数据库注入语句收集及学习">数据库注入语句收集及学习</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-06-02T16:59:09.000Z" title="发表于 2020-06-03 00:59:09">2020-06-03</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></span></div><div class="content">


0x00 任务介绍1、收集网络上各种 sql 注入时使用的 payload 并理解其适用的环境（检测注入、利用注入）
2、记录 sqlmap 的检测和利用过程中使用的 payload（也算一种 payload 收集方式）
3、理解以上涉及的 sql 语句的意思，其中会涉及不同的数据库、不同注入场景，可以将学习的过程和收集的方式进行整理形成报告，关于 payload 的理解，其中会涉及之前学习的基础。
扩展学习：理解 sqlmap 自带 tamper 的原理，这里通常包含很多数据库的特性，从而实现 payload 变形啥的，用来绕过一些简单的安全检测
0x01 收集注入语句盲注1、布尔注入
利用场景	通过页面是否返回正常判定是否存在注入原理	以真假判断是否存在，真为正常，假为不正常(页面区别不大，需仔细辨别不同点来判断是否存在注入)测试流程  存在注入点，判断第一个数据库第一个字符是否等于c  	and substr(database(),3,1)='c'  判断数据库的第一张表的第一个字符是否等于a  	and (ascii(substr((select table_name f ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/2/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/#content-inner">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/#content-inner">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/#content-inner">7</a><a class="extend next" rel="next" href="/page/4/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Time</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">22</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/09/14/Docker%E9%80%83%E9%80%B8/" title="Docker逃逸"><img src="https://wx3.sinaimg.cn/mw2000/006JDWKCly1gxkhxkhlq4j31ln24w1l3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker逃逸"/></a><div class="content"><a class="title" href="/2021/09/14/Docker%E9%80%83%E9%80%B8/" title="Docker逃逸">Docker逃逸</a><time datetime="2021-09-14T08:02:37.000Z" title="发表于 2021-09-14 16:02:37">2021-09-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/22/docker%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/" title="docker进阶学习(一)"><img src="https://wx2.sinaimg.cn/mw2000/006JDWKCly1gxkhxhgnl5j31ln24wb2e.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="docker进阶学习(一)"/></a><div class="content"><a class="title" href="/2021/07/22/docker%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/" title="docker进阶学习(一)">docker进阶学习(一)</a><time datetime="2021-07-22T13:26:34.000Z" title="发表于 2021-07-22 21:26:34">2021-07-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/06/19/HackTheBox-Oopsie-2/" title="HackTheBox-Oopsie-2"><img src="https://wx2.sinaimg.cn/mw2000/006JDWKCly1gxkhxhgnl5j31ln24wb2e.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HackTheBox-Oopsie-2"/></a><div class="content"><a class="title" href="/2021/06/19/HackTheBox-Oopsie-2/" title="HackTheBox-Oopsie-2">HackTheBox-Oopsie-2</a><time datetime="2021-06-18T21:18:30.000Z" title="发表于 2021-06-19 05:18:30">2021-06-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/06/13/HackTheBox-Archetype-1/" title="HackTheBox-Archetype-1"><img src="https://wx2.sinaimg.cn/mw1024/007YyUgtgy1gxx4m230fsj31900u0k0g.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HackTheBox-Archetype-1"/></a><div class="content"><a class="title" href="/2021/06/13/HackTheBox-Archetype-1/" title="HackTheBox-Archetype-1">HackTheBox-Archetype-1</a><time datetime="2021-06-13T12:03:46.000Z" title="发表于 2021-06-13 20:03:46">2021-06-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/02/04/%E6%8C%81%E4%B9%85%E5%8C%96XSS%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" title="持久化XSS漏洞利用"><img src="https://images.pexels.com/photos/10631545/pexels-photo-10631545.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="持久化XSS漏洞利用"/></a><div class="content"><a class="title" href="/2021/02/04/%E6%8C%81%E4%B9%85%E5%8C%96XSS%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" title="持久化XSS漏洞利用">持久化XSS漏洞利用</a><time datetime="2021-02-04T03:29:18.000Z" title="发表于 2021-02-04 11:29:18">2021-02-04</time></div></div></div></div><div class="card-widget" id="card-newest-comments"><div class="item-headline"><i class="fas fa-comment-dots"></i><span>最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/HTML/"><span class="card-category-list-name">HTML</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/HackTheBox/"><span class="card-category-list-name">HackTheBox</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java/"><span class="card-category-list-name">Java</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/SQL%E6%B3%A8%E5%85%A5/"><span class="card-category-list-name">SQL注入</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/SRC/"><span class="card-category-list-name">SRC</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/WAF/"><span class="card-category-list-name">WAF</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/WEB%E4%B9%8B%E5%9B%B0/"><span class="card-category-list-name">WEB之困</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/docker/"><span class="card-category-list-name">docker</span><span class="card-category-list-count">8</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Compose/" style="font-size: 1.1em; color: #999">Compose</a> <a href="/tags/HackTheBox/" style="font-size: 1.2em; color: #999da3">HackTheBox</a> <a href="/tags/JAVA/" style="font-size: 1.3em; color: #99a1ac">JAVA</a> <a href="/tags/Metasploit/" style="font-size: 1.1em; color: #999">Metasploit</a> <a href="/tags/Swarm%E3%80%81%E9%9B%86%E7%BE%A4/" style="font-size: 1.1em; color: #999">Swarm、集群</a> <a href="/tags/Thinkphp/" style="font-size: 1.1em; color: #999">Thinkphp</a> <a href="/tags/WAF/" style="font-size: 1.1em; color: #999">WAF</a> <a href="/tags/WAF%E7%89%B9%E6%80%A7/" style="font-size: 1.1em; color: #999">WAF特性</a> <a href="/tags/docker/" style="font-size: 1.1em; color: #999">docker</a> <a href="/tags/docker%E5%9F%BA%E7%A1%80/" style="font-size: 1.1em; color: #999">docker基础</a> <a href="/tags/docker%E7%BD%91%E7%BB%9C/" style="font-size: 1.1em; color: #999">docker网络</a> <a href="/tags/mysql/" style="font-size: 1.2em; color: #999da3">mysql</a> <a href="/tags/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" style="font-size: 1.1em; color: #999">业务安全</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.2em; color: #999da3">中间件</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%EF%BC%8C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 1.1em; color: #999">代码审计，学习笔记</a> <a href="/tags/%E4%BC%9A%E8%AF%9D%E4%BC%A0%E9%80%92/" style="font-size: 1.1em; color: #999">会话传递</a> <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.4em; color: #99a5b6">内网渗透</a> <a href="/tags/%E5%8D%8F%E8%AE%AE/" style="font-size: 1.1em; color: #999">协议</a> <a href="/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/" style="font-size: 1.1em; color: #999">反编译</a> <a href="/tags/%E5%90%8E%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7/" style="font-size: 1.1em; color: #999">后渗透工具</a> <a href="/tags/%E5%97%85%E6%8E%A2/" style="font-size: 1.1em; color: #999">嗅探</a> <a href="/tags/%E5%9F%9F%E5%86%85%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" style="font-size: 1.2em; color: #999da3">域内信息收集</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 1.4em; color: #99a5b6">学习笔记</a> <a href="/tags/%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/" style="font-size: 1.1em; color: #999">审计学习</a> <a href="/tags/%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7-Dockerfile/" style="font-size: 1.1em; color: #999">容器数据卷,Dockerfile</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.1em; color: #999">工具</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.1em; color: #999">数据库</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" style="font-size: 1.2em; color: #999da3">漏洞复现</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%EF%BC%8C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 1.1em; color: #999">漏洞靶场，学习笔记</a> <a href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" style="font-size: 1.1em; color: #999">环境搭建</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E9%80%83%E9%80%B8/" style="font-size: 1.1em; color: #999">虚拟逃逸</a> <a href="/tags/%E8%A2%AB%E5%8A%A8%E6%89%AB%E6%8F%8F/" style="font-size: 1.1em; color: #999">被动扫描</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 1.2em; color: #999da3">随笔</a> <a href="/tags/%E9%9D%B6%E5%9C%BA%E5%AE%9E%E6%88%98/" style="font-size: 1.5em; color: #99a9bf">靶场实战</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/09/"><span class="card-archive-list-date">九月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/07/"><span class="card-archive-list-date">七月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/06/"><span class="card-archive-list-date">六月 2021</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/02/"><span class="card-archive-list-date">二月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/01/"><span class="card-archive-list-date">一月 2021</span><span class="card-archive-list-count">8</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/12/"><span class="card-archive-list-date">十二月 2020</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/11/"><span class="card-archive-list-date">十一月 2020</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/10/"><span class="card-archive-list-date">十月 2020</span><span class="card-archive-list-count">3</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">67</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-01-01T01:52:28.206Z"></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://wallroom.io/img/3840x2160/bg-3579ca5.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2022 By Time</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://timeshu.github.io">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    var typed = new Typed("#subtitle", {
      strings: "无人陪我立黄昏,Today’s efforts will eventually reward you in the future".split(","),
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50
    })
  } else {
    document.getElementById("subtitle").innerHTML = '无人陪我立黄昏'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const findTrueUrl = (array) => {
    Promise.all(array.map(item =>
      fetch(item.url).then(resp => resp.json()).then(data => {
        const urlArray = data.body.match(/(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?/ig)
        if (data.user.login === 'utterances-bot') {
          return urlArray.pop()
        } else {
          return urlArray.shift()
        }
      })
    )).then(res => {
        array = array.map((i,index)=> {
          return {
            ...i,
            url: res[index]
          }
        })

        saveToLocal.set('github-newest-comments', JSON.stringify(array), 10/(60*24))
        generateHtml(array)
    });
  }

  const getComment = () => {
    fetch('https://api.github.com/repos/TimeSHU/blog-comments/issues/comments?sort=updated&direction=desc&per_page=6&page=1',{
      "headers": {
        Accept: 'application/vnd.github.v3.html+json'
      }
    })
      .then(response => response.json())
      .then(data => {
        const githubArray = data.map(item => {
          return {
            'avatar': item.user.avatar_url,
            'content': changeContent(item.body_html),
            'nick': item.user.login,
            'url': item.issue_url,
            'date': item.updated_at,
            'githubUrl': item.html_url
          }
        })
        findTrueUrl(githubArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      })
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('github-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>