<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Time'Blog</title><meta name="author" content="Time"><meta name="copyright" content="Time"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="Time&#39;Blog">
<meta property="og:url" content="https://timeshu.github.io/index.html">
<meta property="og:site_name" content="Time&#39;Blog">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://timeshu.github.io/img/avatar.jpg">
<meta property="article:author" content="Time">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://timeshu.github.io/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://timeshu.github.io/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?https://hm.baidu.com/hm.js?5dd9b277051da31b80703896f0394cce";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Time\'Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-03-28 14:53:16'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">74</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://wallroom.io/img/3840x2160/bg-3579ca5.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Time'Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Time'Blog</h1><div id="site-subtitle"><span id="subtitle"></span></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/03/12/Ysoserial%E5%B7%A5%E5%85%B7-CommonsCollections1/" title="Ysoserial工具-CommonsCollections1">     <img class="post_bg" src="https://images.pexels.com/photos/10643916/pexels-photo-10643916.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ysoserial工具-CommonsCollections1"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/03/12/Ysoserial%E5%B7%A5%E5%85%B7-CommonsCollections1/" title="Ysoserial工具-CommonsCollections1">Ysoserial工具-CommonsCollections1</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-03-12T00:46:34.000Z" title="发表于 2022-03-12 08:46:34">2022-03-12</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Ysoserial%E5%B7%A5%E5%85%B7/">Ysoserial工具</a></span></div><div class="content">参考链接https://zhuanlan.zhihu.com/p/349838623
https://leihehe.top/2021/07/31/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%B9%8B%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90%E9%9B%86%E5%90%88-4/
https://www.guildhab.top/2020/08/java-%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%bc%8f%e6%b4%9e6-%e8%a7%a3%e5%af%86-ysoserial-urldns-pop-chain/
https://xz.aliyun.com/t/7157#toc-1
https://www.freebuf.com/articles/web/312175.html
</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/03/06/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-RBAC%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" title="Java代码审计-RBAC管理系统">     <img class="post_bg" src="https://images.pexels.com/photos/10631545/pexels-photo-10631545.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java代码审计-RBAC管理系统"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/03/06/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-RBAC%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" title="Java代码审计-RBAC管理系统">Java代码审计-RBAC管理系统</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-03-06T04:58:43.000Z" title="发表于 2022-03-06 12:58:43">2022-03-06</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></span></div><div class="content">0X01 环境搭建gitee下载地址：https://gitee.com/witmy/my-springsecurity-plus
导入 IEDA 项目后，自动根据 pox.xml 下载依赖包
注意：需要在 settings–plugins 中搜索并安装 lombok 插件，不然会报错

创建 rbac 空数据库，导入 sql 文件

默认端口是 8088 ，可自行在 RefiningStone-RBAC(最终版)/src/main/resources/application.yml 中修改端口。
至此环境搭建成功。
0X02 SQL注入RBAC 管理系统 使用 Mybatis 框架操作数据库

搜索 $ 

UserMapper.xml  id 为 getFuzzyUserByPage

根据分层架构 ，我们找到对应的 dao 层映射文件 
RefiningStone-RBAC(最终版)/src/main/java/com/codermy/myspringsecurityplus/admin/dao/UserDao.java

实现层在 service 

</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/02/23/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-OFCMS/" title="Java代码审计-OFCMS">     <img class="post_bg" src="https://images.pexels.com/photos/10622715/pexels-photo-10622715.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java代码审计-OFCMS"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/02/23/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-OFCMS/" title="Java代码审计-OFCMS">Java代码审计-OFCMS</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-02-23T01:51:43.000Z" title="发表于 2022-02-23 09:51:43">2022-02-23</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></span></div><div class="content">0X01 环境搭建Gitee 下载: https://gitee.com/oufu/ofcms
导入 IEDA ，Maven 根据 pox.xml 自动下载依赖组件创建 ofcms 空数据库 
修改
ofcms-master/ofcms-admin/src/main/resources/dev/conf/db-config.properties改为ofcms-master/ofcms-admin/src/main/resources/dev/conf/db.properties



Tomcat 配置 


启动，安装CMS


重启容器


安装成功！
0X02 SQL注入漏洞分析漏洞点：ofcms-admin/src/main/java/com/ofsoft/cms/admin/controller/system/SystemGenerateController.java
47 行处，语句直接获取，未经过任何过滤

跟进 update

此处获取数据库资源连接，然后传送sql语句

跟进

pst.executeUpdate 执行了 sql 语句
而这个对象方法只允许执行 ins ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/02/20/%E5%90%91%E6%97%A5%E8%91%B5RCE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="向日葵RCE漏洞复现">     <img class="post_bg" src="https://images.pexels.com/photos/10643916/pexels-photo-10643916.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="向日葵RCE漏洞复现"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/02/20/%E5%90%91%E6%97%A5%E8%91%B5RCE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="向日葵RCE漏洞复现">向日葵RCE漏洞复现</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-02-20T12:16:26.000Z" title="发表于 2022-02-20 20:16:26">2022-02-20</time></span></div><div class="content">漏洞版本：
向日葵个人版for Windows 11.0.0.33 &lt;=
向日葵简约版 V1.0.1.43315（2021.12）
11.1.1
10.3.0.27372
11.0.0.33162
版本下载：
官方网址下载然后抓包遍历ID即可
工具下载：
https://github.com/Mr-xn/sunlogin_rce
procexp64下载
http://www.xitongzhijia.net/soft/210933.html
第一步：获取向日葵监听的端口
打开 procexp ，右键点击向日葵，选中属性

监听端口

端口号：53921



第二步:获取 verify_string 值
http://10.211.55.6:53921/cgi-bin/rpc?action=verify-haras


verify_string:  0243aFf9X19BCrB9vrfSLludf4jc9lai



第三步：拼接 payload 执行命令
http://10.211.55.6:53921/check?cmd=ping..%2F..%2F..%2F..%2F. ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/02/09/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-Log4j2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="Java代码审计-Log4j2漏洞分析">     <img class="post_bg" src="https://images.pexels.com/photos/8761731/pexels-photo-8761731.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java代码审计-Log4j2漏洞分析"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/02/09/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-Log4j2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="Java代码审计-Log4j2漏洞分析">Java代码审计-Log4j2漏洞分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-02-08T21:41:45.000Z" title="发表于 2022-02-09 05:41:45">2022-02-09</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></span></div><div class="content">0X01 Log4j2 组件Log4j2 日志组件是一款比较优秀的 Java程序日志监控组件，同属于 Java全生态中的基础组件之一。最近被爆出 RCE 漏洞，据不完全统计，影响多达60644个开源软件，涉及相关版本软件包更是达到321094个。且利用方式简单，之前测 XSS 的点，都可以用来插入恶意代码，被称为核弹级漏洞。
0X02 RMIRMI 概念要分析 Log4j2 漏洞 就得了解一下 RMI 和 JNDI。
RMI 全称 Remote Method Invocation，是 JAVA 实现远程过程调用的应用程序编程接口，存储于 java.rmi 包中，使用期方法调用对象时，必须实现 Remote远程接口。它可以让客户机上运行的程序调用远程服务器上的对象。而远程方法调用的特性可以让开发者能够在网络环境中分布操作。RMI 宗旨就是尽可能简化远程接口对象的使用。
RMI 三层架构
客户端
存根/桩(Stub)：远程对象在客户端上的代理。
远程引用层(Remote Reference Layer)：解析并执行远程引用协议。
传输层(Transport)：发送调用、传递远程方法参数、接 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/01/25/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-shiro-721%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%BA%94/" title="Java反序列化-shiro-721反序列化(五)">     <img class="post_bg" src="https://images.pexels.com/photos/10651587/pexels-photo-10651587.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java反序列化-shiro-721反序列化(五)"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/25/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-shiro-721%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%BA%94/" title="Java反序列化-shiro-721反序列化(五)">Java反序列化-shiro-721反序列化(五)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-25T14:08:24.000Z" title="发表于 2022-01-25 22:08:24">2022-01-25</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></span></div><div class="content">
收集了网上很多关于 shiro 721序列化的文章，发现都有讲加密这一块，所以也准备跟着文章来学习一下。

0X01 AES 加解密目前的密码体制可以分为两种：“对称加密” 和 “非对称加密”
对称加密  – 加解密密钥都是同一个，既可加密又可解密
- AES
- DES

非对称加密  – 一对密钥由公钥和私钥组成，公私钥都可用来加解密。私钥不能外泄，公钥可以交给所有请求方

RSA
ECC
Rabin
背包算法
Elgamal
……

目前对称加密 AES 和非对称加密 RSA 使用的比较广泛。
AES 算法我们都知道 shiro 是用的 AES 加密方法，AES 属于分组加密算法
明文长度固定为 128 位。
密钥长度可以是 128、192 、256 位

分组加密模式共有五种

ECS ( Electronic Codebook Book , 电话本模式 )
CBC ( Cipher Block Chaining , 密码分组链接模式 )
CTR ( Counter , 计算器模式 )
CFB ( Cipher FeedBack , 密码反馈模式 )
OFB ( Output ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/01/22/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-shiro-550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9B%9B/" title="Java反序列化-shiro-550反序列化漏洞(四)">     <img class="post_bg" src="https://images.pexels.com/photos/10620135/pexels-photo-10620135.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java反序列化-shiro-550反序列化漏洞(四)"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/22/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-shiro-550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9B%9B/" title="Java反序列化-shiro-550反序列化漏洞(四)">Java反序列化-shiro-550反序列化漏洞(四)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-21T16:44:51.000Z" title="发表于 2022-01-22 00:44:51">2022-01-22</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></span></div><div class="content">0X01 shiro-550反序列漏洞最近审计到一套CMS，发现存在shiro反序列化漏洞，但之前没有分析复现过，审计的时候比较吃力。所以有了本篇文章，迟早要学，不如就现在。
环境搭建下载地址：https://codeload.github.com/apache/shiro/zip/shiro-root-1.2.4
注意：主目录是shiro-root-1.2.4/samples/web
修改 shiro-root-1.2.4/samples/web 目录下的 pox.xml，添加如下内容
&lt;!--  需要设置编译的版本 --&gt;     &lt;properties&gt;        &lt;maven.compiler.source&gt;1.6&lt;/maven.compiler.source&gt;        &lt;maven.compiler.target&gt;1.6&lt;/maven.compiler.target&gt;    &lt;/properties&gt;...    &lt;dependencies&gt;        &lt;dep ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/01/15/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-MCMS/" title="Java代码审计-MCMS">     <img class="post_bg" src="https://images.pexels.com/photos/10631545/pexels-photo-10631545.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java代码审计-MCMS"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/15/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-MCMS/" title="Java代码审计-MCMS">Java代码审计-MCMS</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-15T11:24:18.000Z" title="发表于 2022-01-15 19:24:18">2022-01-15</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></span></div><div class="content">0X01 环境搭建项目地址下载：https://gitee.com/mingSoft/MCMS
当前版本：5.2.5  也可下载的releases版本 5.2.4

PS：注意Mysql版本需大于5.6以上
创建一个mcms数据库，并且导入doc/数据库文件
在application-dev中修改数据库账户密码
运行MSApplication.java main方法，如下图，环境无问题
管理员：msopen/密码：msopen

外置环境配置搭建Tomcat环境

注意：环境最好使用1.8版本，作者使用15版本，打包war时一直报错，版本不对，最后将1.8设置默认版本后才成功。

编辑 pox.xml 修改打包方式为 war 包
&lt;!-- 打包成war包 --&gt;&lt;packaging&gt;war&lt;/packaging&gt;



添加依赖
&lt;dependency&gt;  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;  &lt;artifactId&gt;spring-boot-start ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/01/02/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E5%8F%8D%E5%B0%84%E4%BA%8C/" title="Java反序列化-反射(二)">     <img class="post_bg" src="https://images.pexels.com/photos/10631545/pexels-photo-10631545.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java反序列化-反射(二)"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/02/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E5%8F%8D%E5%B0%84%E4%BA%8C/" title="Java反序列化-反射(二)">Java反序列化-反射(二)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-01T23:40:12.000Z" title="发表于 2022-01-02 07:40:12">2022-01-02</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></span></div><div class="content">0x01 Java反射
Java反射(Reflection)是Java非常重要的动态特性，通过使用反射我们不仅可以获取到任何类的成员方法(Methods)、成员变量(Fields)、构造方法(Constructors)等信息，还可以动态创建Java类实例、调用任意的类方法、修改任意的类成员变量值等。Java反射机制是Java语言的动态性的重要体现，也是Java的各种框架底层实现的灵魂。
​                                            - 摘抄知识盒子园长代码审计系列

什么是反射？Java反射机制的核心是在程序运行时动态加载类并获取类的详细信息，从而操作类或对象的属性和方法，本质是JVM得到class对象之后，再通过class对象进行反编译，从而获取对象的各种信息。
Java属于先编译再运行的语言，程序中对象的类型在编译期就确定下来了，而当程序在运行时可能需要动态加载某些类，这些类因为之前用不到，所以没有被加载到JVM。通过反射，可以在运行时动态创建对象并调用其属性，不需要提前在编译期知道运行的对象是谁。
反射的原理如下图
1、创建一个·Per ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/01/02/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E5%9F%BA%E7%A1%80%E4%B8%80/" title="Java反序列化-基础(一)">     <img class="post_bg" src="https://images.pexels.com/photos/10643916/pexels-photo-10643916.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java反序列化-基础(一)"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/02/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E5%9F%BA%E7%A1%80%E4%B8%80/" title="Java反序列化-基础(一)">Java反序列化-基础(一)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-01T20:53:08.000Z" title="发表于 2022-01-02 04:53:08">2022-01-02</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></span></div><div class="content">OXO1 序列化介绍​    序列化（Serializable）是将数据对象转换成有序的字节流，便于保存在内存、文件、数据库中。而当需要使用数据时通过反序列化（Deserializable）的操作将字节流对象重建。
​    在Java中序列化使用 ObjectiOutputStream类的writerObject()方法实现，反序列化使用ObjectInputStream类的readObjetion()方法实现。

ObjectiOutputStream  对象序列化流
writerObject()  序列化


ObjectInputStream    对象反序列化流
readObjetion()  反序列化


Serializable、Externalizable
标记接口，没有方法或字段，一旦实现该接口，标志该类的对象是可序列化



而序列化的目的是为了让java对象脱离java运行环境的一种手段，可以实现网络传输（RMI RPC），对象持久化存储。
0x02 序列化漏洞原理测试代码：通过下面的小栗子来了解序列化
package com.time.Serializable; ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/#content-inner">8</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Time</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">74</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/03/12/Ysoserial%E5%B7%A5%E5%85%B7-CommonsCollections1/" title="Ysoserial工具-CommonsCollections1"><img src="https://images.pexels.com/photos/10643916/pexels-photo-10643916.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ysoserial工具-CommonsCollections1"/></a><div class="content"><a class="title" href="/2022/03/12/Ysoserial%E5%B7%A5%E5%85%B7-CommonsCollections1/" title="Ysoserial工具-CommonsCollections1">Ysoserial工具-CommonsCollections1</a><time datetime="2022-03-12T00:46:34.000Z" title="发表于 2022-03-12 08:46:34">2022-03-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/06/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-RBAC%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" title="Java代码审计-RBAC管理系统"><img src="https://images.pexels.com/photos/10631545/pexels-photo-10631545.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java代码审计-RBAC管理系统"/></a><div class="content"><a class="title" href="/2022/03/06/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-RBAC%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" title="Java代码审计-RBAC管理系统">Java代码审计-RBAC管理系统</a><time datetime="2022-03-06T04:58:43.000Z" title="发表于 2022-03-06 12:58:43">2022-03-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/23/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-OFCMS/" title="Java代码审计-OFCMS"><img src="https://images.pexels.com/photos/10622715/pexels-photo-10622715.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java代码审计-OFCMS"/></a><div class="content"><a class="title" href="/2022/02/23/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-OFCMS/" title="Java代码审计-OFCMS">Java代码审计-OFCMS</a><time datetime="2022-02-23T01:51:43.000Z" title="发表于 2022-02-23 09:51:43">2022-02-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/20/%E5%90%91%E6%97%A5%E8%91%B5RCE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="向日葵RCE漏洞复现"><img src="https://images.pexels.com/photos/10643916/pexels-photo-10643916.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="向日葵RCE漏洞复现"/></a><div class="content"><a class="title" href="/2022/02/20/%E5%90%91%E6%97%A5%E8%91%B5RCE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="向日葵RCE漏洞复现">向日葵RCE漏洞复现</a><time datetime="2022-02-20T12:16:26.000Z" title="发表于 2022-02-20 20:16:26">2022-02-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/09/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-Log4j2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="Java代码审计-Log4j2漏洞分析"><img src="https://images.pexels.com/photos/8761731/pexels-photo-8761731.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java代码审计-Log4j2漏洞分析"/></a><div class="content"><a class="title" href="/2022/02/09/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-Log4j2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="Java代码审计-Log4j2漏洞分析">Java代码审计-Log4j2漏洞分析</a><time datetime="2022-02-08T21:41:45.000Z" title="发表于 2022-02-09 05:41:45">2022-02-09</time></div></div></div></div><div class="card-widget" id="card-newest-comments"><div class="item-headline"><i class="fas fa-comment-dots"></i><span>最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Docker/"><span class="card-category-list-name">Docker</span><span class="card-category-list-count">7</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JWT/"><span class="card-category-list-name">JWT</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80/"><span class="card-category-list-name">Java基础</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/SRC/"><span class="card-category-list-name">SRC</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/WAF/"><span class="card-category-list-name">WAF</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Ysoserial%E5%B7%A5%E5%85%B7/"><span class="card-category-list-name">Ysoserial工具</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/web%E5%B7%A5%E5%85%B7/"><span class="card-category-list-name">web工具</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><span class="card-category-list-name">代码审计</span><span class="card-category-list-count">17</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Compose/" style="font-size: 1.1em; color: #999">Compose</a> <a href="/tags/HackTheBox/" style="font-size: 1.18em; color: #999ca1">HackTheBox</a> <a href="/tags/JAVA/" style="font-size: 1.34em; color: #99a3b0">JAVA</a> <a href="/tags/Java/" style="font-size: 1.42em; color: #99a6b7">Java</a> <a href="/tags/Metasploit/" style="font-size: 1.1em; color: #999">Metasploit</a> <a href="/tags/PHP/" style="font-size: 1.18em; color: #999ca1">PHP</a> <a href="/tags/Swarm%E3%80%81%E9%9B%86%E7%BE%A4/" style="font-size: 1.1em; color: #999">Swarm、集群</a> <a href="/tags/WAF/" style="font-size: 1.1em; color: #999">WAF</a> <a href="/tags/WAF%E7%89%B9%E6%80%A7/" style="font-size: 1.1em; color: #999">WAF特性</a> <a href="/tags/docker%E5%9F%BA%E7%A1%80/" style="font-size: 1.18em; color: #999ca1">docker基础</a> <a href="/tags/docker%E7%BD%91%E7%BB%9C/" style="font-size: 1.1em; color: #999">docker网络</a> <a href="/tags/mysql/" style="font-size: 1.34em; color: #99a3b0">mysql</a> <a href="/tags/nosql/" style="font-size: 1.1em; color: #999">nosql</a> <a href="/tags/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" style="font-size: 1.1em; color: #999">业务安全</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.18em; color: #999ca1">中间件</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%EF%BC%8C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 1.1em; color: #999">代码审计，学习笔记</a> <a href="/tags/%E4%BC%9A%E8%AF%9D%E4%BC%A0%E9%80%92/" style="font-size: 1.1em; color: #999">会话传递</a> <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.26em; color: #999fa8">内网渗透</a> <a href="/tags/%E5%8D%8F%E8%AE%AE/" style="font-size: 1.1em; color: #999">协议</a> <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.5em; color: #99a9bf">反序列化</a> <a href="/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/" style="font-size: 1.1em; color: #999">反编译</a> <a href="/tags/%E5%90%8E%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7/" style="font-size: 1.1em; color: #999">后渗透工具</a> <a href="/tags/%E5%9F%9F%E5%86%85%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" style="font-size: 1.18em; color: #999ca1">域内信息收集</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 1.26em; color: #999fa8">学习笔记</a> <a href="/tags/%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/" style="font-size: 1.1em; color: #999">审计学习</a> <a href="/tags/%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7-Dockerfile/" style="font-size: 1.1em; color: #999">容器数据卷,Dockerfile</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.1em; color: #999">工具</a> <a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 1.18em; color: #999ca1">渗透测试</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" style="font-size: 1.18em; color: #999ca1">漏洞复现</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%EF%BC%8C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 1.1em; color: #999">漏洞靶场，学习笔记</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E9%80%83%E9%80%B8/" style="font-size: 1.1em; color: #999">虚拟逃逸</a> <a href="/tags/%E8%A2%AB%E5%8A%A8%E6%89%AB%E6%8F%8F/" style="font-size: 1.1em; color: #999">被动扫描</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 1.18em; color: #999ca1">随笔</a> <a href="/tags/%E9%9D%B6%E5%9C%BA%E5%AE%9E%E6%88%98/" style="font-size: 1.34em; color: #99a3b0">靶场实战</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/03/"><span class="card-archive-list-date">三月 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/02/"><span class="card-archive-list-date">二月 2022</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/01/"><span class="card-archive-list-date">一月 2022</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/09/"><span class="card-archive-list-date">九月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/07/"><span class="card-archive-list-date">七月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/06/"><span class="card-archive-list-date">六月 2021</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/02/"><span class="card-archive-list-date">二月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/01/"><span class="card-archive-list-date">一月 2021</span><span class="card-archive-list-count">7</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">74</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-03-28T06:53:16.199Z"></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://wallroom.io/img/3840x2160/bg-3579ca5.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2022 By Time</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://timeshu.github.io">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    var typed = new Typed("#subtitle", {
      strings: "无人陪我立黄昏,Today’s efforts will eventually reward you in the future".split(","),
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50
    })
  } else {
    document.getElementById("subtitle").innerHTML = '无人陪我立黄昏'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const findTrueUrl = (array) => {
    Promise.all(array.map(item =>
      fetch(item.url).then(resp => resp.json()).then(data => {
        const urlArray = data.body.match(/(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?/ig)
        if (data.user.login === 'utterances-bot') {
          return urlArray.pop()
        } else {
          return urlArray.shift()
        }
      })
    )).then(res => {
        array = array.map((i,index)=> {
          return {
            ...i,
            url: res[index]
          }
        })

        saveToLocal.set('github-newest-comments', JSON.stringify(array), 10/(60*24))
        generateHtml(array)
    });
  }

  const getComment = () => {
    fetch('https://api.github.com/repos/TimeSHU/blog-comments/issues/comments?sort=updated&direction=desc&per_page=6&page=1',{
      "headers": {
        Accept: 'application/vnd.github.v3.html+json'
      }
    })
      .then(response => response.json())
      .then(data => {
        const githubArray = data.map(item => {
          return {
            'avatar': item.user.avatar_url,
            'content': changeContent(item.body_html),
            'nick': item.user.login,
            'url': item.issue_url,
            'date': item.updated_at,
            'githubUrl': item.html_url
          }
        })
        findTrueUrl(githubArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      })
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('github-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>